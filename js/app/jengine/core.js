!(function(c){c.Logger=function(){};c.Logger.level=4;c.Logger.errorUri="http://search.china.alibaba.com/rpc/dragoontrack/logError.json?msg=";c.Logger.setLevel=function(e){c.Logger.level=e};var d=false;var a=["error","warn","info","debug","log"];c.extend(c.Logger.prototype,{level:c.Logger.level,setEnableLevel:function(e){if(e>4||e<0){this.error(["wrong level setting. level should be 0-4, the int type,you set ",e,", so stupided."].join(""))}this.level=parseInt(e)},enabled:function(e){if(e>c.Logger.level){return false}return true},name:function(){return this._name},log:function(){this._log(4,arguments)},debug:function(){this._log(3,arguments)},info:function(){this._log(2,arguments)},warn:function(){this._log(1,arguments)},error:function(){this._log(0,arguments)},_handler:function(j,g,h){var i=a[j];h=[[i+"|"].join(" | ")].concat(Array.prototype.slice.call(h));if(self.console&&!c.browser.msie){if(console.log.apply){console[i].apply(console,h)}else{console[console[i]?i:"log"](h)}}else{if(c.browser.msie){if(/debug=true/i.test(location.search)){!d&&this._prepare();var e=c("#DEBUG ol");var f;switch(i){case"log":f="#FFFFFF";break;case"debug":f="#C0C0C0";break;case"info":f="#EBF5FF";break;case"warn":f="#FFFFC8";break;case"error":f="#FE6947";break;default:f="#FFFFFF";break}c('<li style="background-color:'+f+';">').text(""+h).appendTo(e)}}}if(!DEBUG_MOD){if(j==0||j==1){(new Image()).src=c.Logger.errorUri+this._getBrowserInfo()+h}}},_log:function(f,e){if(this.enabled(f)){this._handler(f,this.name(),e)}},_getBrowserInfo:function(){var e="browser:";c.each(jQuery.browser,function(f,g){if(f!="version"){e=e+f+" "}else{e=e+g+"|"}});return e},_prepare:function(){c("#DEBUG").remove();c(document.body).append('<div id="DEBUG" style="margin-top:10px;padding:8px;border:dashed 1px #FF7300;background-color:#EEE;color:#000;"><ol></ol></div>');d=true},end:0});var b={};c.getLogger=function(e){if(!b[e]){b[e]=new c.Logger(e);b[e]._name=e}return b[e]};c.logger=c.getLogger("jEngine");if(DEBUG_MOD){c.logger.setEnableLevel(4)}else{c.logger.setEnableLevel(2)}})(jQuery);!(function(a){function b(c,e,d){return this.init(c,e,d)}a.extend(b.prototype,{init:function(c,e,d){this.core=c;this.moduleId=e;this.options=d!=null?d:{}}});jEngine.Core.Sandbox=b})(jQuery);!(function(a){function b(c){this.channels={};if(c){this.installTo(c)}}a.extend(b.prototype,{on:function(g,h,d){var c,l,k,f,j,e;if(d==null){d=this}if(this.channels[g]==null){this.channels[g]=[]}k=this;if(g instanceof Array){e=[];for(f=0,j=g.length;f<j;f++){c=g[f];e.push(this.subscribe(c,h,d))}return e}else{l={context:d,callback:h};return{attach:function(){k.channels[g].push(l);return this},detach:function(){b._rm(k,g,l.callback);return this}}.attach()}},off:function(d,c){var e;switch(typeof d){case"string":if(typeof c==="function"){b._rm(this,d,c)}if(typeof c==="undefined"){b._rm(this,d)}break;case"function":for(e in this.channels){b._rm(this,e,d)}break;case"undefined":for(e in this.channels){b._rm(this,e)}break;case"object":for(e in this.channels){b._rm(this,e,null,d)}}return this},notify:function(h,f,m){var c,d,n,l,g,j,e;if(this.channels[h]!=null){e=this.channels[h];for(g=0,j=e.length;g<j;g++){n=e[g];if(m!==true&&typeof f==="object"){if(f instanceof Array){c=(function(){var o,i,k;k=[];for(o=0,i=f.length;o<i;o++){l=f[o];k.push(l)}return k})()}else{c={};for(d in f){l=f[d];c[d]=l}}n.callback.apply(n.context,[c,h])}else{n.callback.apply(n.context,[f,h])}}}return this},installTo:function(c){if(typeof c==="object"){c.on=this.on;c.off=this.off;c.notify=this.notify;c.channels=this.channels}return this}});b._rm=function(g,f,d,c){var e;return g.channels[f]=(function(){var k,j,l,h;l=g.channels[f];h=[];for(k=0,j=l.length;k<j;k++){e=l[k];if((d!=null?e.callback!==d:c!=null?e.context!==c:e.context!==g)){h.push(e)}}return h})()};jEngine.Core.Mediator=b})(jQuery);!(function(f){var g,h={threshold:250,end:0};var b=false;var e=f(window);var c=0;var a=[];var i={};function d(j){g=j;g.on("jEngine.lazyLoad",function(k){d._handleManualEvent(k)});return d}f.extend(d,{register:function(m,n,j,q){var l=f.extend(true,{},h,j);if(m){var p=f(m);if(!p||p.length==0||!n){return false}var k=this;if(n==="exposure"){this._handleExposureEvent(p,l,q)}else{var o=function(r){k._getModule(this,l,q,n);p.unbind(n,o)};p.bind(n,o)}}else{if(n==="manual"){i[l.key]=[l,q]}}return true},_handleExposureEvent:function(l,j,m){var k=this._pushToArray(l,j,m);this._uniqueMerge(a,k);if(!b){c=this._getViewportHeight();this._bindExposureEvent()}this._loadModules()},_handleManualEvent:function(k){if(k.moduleId){var j=i[k.moduleId];if(j){this._getModule(null,j[0],j[1]);delete i[k.moduleId]}}},_pushToArray:function(m,k,n){var j=[];if(!m.length){return j}for(var l=0;l<m.length;l++){j.push([m[l],k,n])}return j},_uniqueMerge:function(o,l){for(var n=0;n<l.length;n++){for(var m=0,k=o.length;m<k;m++){if(l[n]===o[m]){l.splice(n,1);break}}}f.merge(o,l)},_bindExposureEvent:function(){if(b){return}var j=this;e.bind("scroll.lazymodule",function(k){j._exposureCall(j._loadModules,j)});e.bind("resize.lazymodule",function(k){c=j._getViewportHeight();j._exposureCall(j._loadModules,j)});b=true},_removeEvent:function(){if(!b){return}e.unbind("scroll.lazymodule");e.unbind("resize.lazymodule");b=false},_exposureCall:function(k,j){clearTimeout(k.tId);k.tId=setTimeout(function(){k.call(j)},100)},_loadModules:function(){this._filter(a,this._runCallback,this);if(a.length===0){this._removeEvent()}},_filter:function(r,q,m){var o;for(var l=0;l<r.length;){o=r[l];if(f.isArray(o)&&this._checkPosition(o)){r.splice(l,1);q.call(m,o);if(!o[1].keep){var n=o[1].key;for(var k=0;k<r.length;){var p=r[k];if(n===p[1].key){r.splice(k,1)}else{k++}}}}else{l++}}},_runCallback:function(j){var m,l,k;m=j[0];k=j[1];l=j[2];this._getModule(m,k,l)},_getModule:function(n,j,m,p){var k=this;var l=j.module;if(l){var o=l.moduleId;f.add(o,{js:l.js,css:l.css});if(m){f.use(o,function(){m(n);if(p){k._dispatchEvent(n,p)}})}else{f.use(o)}}else{if(m){m(n)}}},_getViewportHeight:function(){return e.height()},_checkPosition:function(m){var k=false;var j=m[1].threshold?m[1].threshold:h.threshold;var o=f(document).scrollTop();var n=o+c+j;var l=(f(m).css("display")!=="none")?f(m).offset().top:Number.POSITIVE_INFINITY;if(l<=n){k=true}return k},_dispatchEvent:function(m,j){try{if(document.createEvent){var k=document.createEvent("MouseEvents");k.initEvent(j,true,false);m.dispatchEvent(k)}else{if(document.createEventObject){m.fireEvent("on"+j)}}return true}catch(l){return false}},end:0});jEngine.Core.LazyModule=d})(jQuery);!(function(a){var b={dataField:"data-mod-config",combineField:"combine-mod-config",scriptField:"script-mod-config",AllReadyEvent:"jEngine.ready",end:0};function c(d){this.init(d)}a.extend(c.prototype,{init:function(d){this.config=a.extend(true,{},b,d);this.moduleData={};this.mediator=new jEngine.Core.Mediator();this.lazyModule=new jEngine.Core.LazyModule(this.mediator)},register:function(g,f,e){if(e==null){e={}}try{this._addModule(g,f,e);if(e.init){return this.start(g)}return true}catch(d){if(!DEBUG_MOD){a.logger.error("could not register "+g+" because: "+d.message)}else{throw d}return false}},lazyRegister:function(e,g,i,d,f){if(f==null){f={}}try{var f=this._getModuleCombine(e,f);var j=false;if(f.init===false){j=this.lazyModule.register(i,d,f)}else{var l=this;var h=null;if(f.callback){if(g){h=function(){if(l._lazyStart(e,g)){f.callback()}}}else{h=f.callback}}else{h=function(){l._lazyStart(e,g)}}j=this.lazyModule.register(i,d,f,h)}return j}catch(k){if(!DEBUG_MOD){a.logger.error("could not lazyregister "+e+" because: "+k.message)}else{throw k}return false}},unregister:function(d){if(this.moduleData[d]!=null){delete this.moduleData[d];return true}else{return false}},start:function(g){try{if(this.moduleData[g]==null){throw new Error("module "+g+" does not exist")}var h=a.now();var f=this.moduleData[g].options;if(f==null){f={}}var d=this._createInstance(g,f);if(d.running===true){throw new Error("module "+g+" was already started")}if(typeof d.init!=="function"){throw new Error("module "+g+" do not have an init function")}d.init(d.options);d.running=true;this.moduleData[g].instance=d;if(typeof f.callback==="function"){f.callback()}a.logger.info(g+" init finished, cost:"+ +(a.now()-h)+" ms");return true}catch(e){if(!DEBUG_MOD){a.logger.error(g+" init Error: "+e.message)}else{throw e}return false}},startAll:function(){var e,d;d=[];for(e in this.moduleData){if(this.moduleData.hasOwnProperty(e)){d.push(this.start(e))}}this.mediator.notify(this.config.AllReadyEvent);return d},stop:function(e){var d=this.moduleData[e];if(d.instance){if(a.isFunction(d.instance.destroy)){d.instance.destroy()}d.instance.running=false;d.instance=null;return true}else{return false}},stopAll:function(){var e,d;d=[];for(e in this.moduleData){if(this.moduleData.hasOwnProperty(e)){d.push(this.stop(e))}}return d},restart:function(d){if(this.stop(d)){return this.start(d)}return false},_addModule:function(g,f,e){if(typeof g!=="string"){throw new Error("moudule ID has to be a string")}var d=f;if(typeof f==="string"){f=this._parseFunction(f)}if(typeof f!=="function"){throw new Error(f+" creator "+d+" has to be a constructor function")}if(typeof e!=="object"){throw new Error("option parameter has to be an object")}if(this.moduleData[g]!=null){throw new Error("module was already registered")}this.moduleData[g]={creator:f,options:e};return true},_createInstance:function(h,g){var f=this.moduleData[h];if(f.instance!=null){return f.instance}var j=new jEngine.Core.Sandbox(jEngine.Core.AppEntity,h,g);this.mediator.installTo(j);var g=this._getModuleConfig(h,g);var d=new f.creator(j),e,i;d.options=g;if(!DEBUG_MOD){for(e in d){i=d[e];if(typeof i=="function"){d[e]=function(k,l){return function(){try{return l.apply(this,arguments)}catch(m){a.logger.error(h+" throw error: "+k+"()-> "+m.message)}}}(e,i)}}}return d},_lazyStart:function(e,d){if(this.moduleData[e]==null){if(this.register(e,d)){return this.start(e)}}return false},_getModuleConfig:function(i,g){var k="#"+i;var h=a(k);if(h.length>0){var j=h.attr(this.config.dataField);if(j&&j.trim()){g.data=a.parseJSON(j)}var f=h.attr(this.config.scriptField);if(f&&f.trim()){var e=a.parseJSON(f);var d=a("#"+e.script);if(d.length>0){if(e.replace){h.replaceWith(d.html())}else{h.html(d.html())}}}g.id=i;g.dom=h}return g},_getModuleCombine:function(f,d){if(typeof(d.module)!=="undefined"){var g="#"+f;var e=a(g);if(e.length>0){var h=e.attr(this.config.combineField);if(h&&h.trim()){d.module=d.module[h]}}d.module.moduleId=f}d.key=f;return d},_parseFunction:function(g){var e=g.split("."),d=e.length,h=window;for(var f=(a.isWindow(e[0])?1:0);f<d;f++){if(a.isFunction(h[e[f]])||a.isPlainObject(h[e[f]])){h=h[e[f]]}else{return null}}if(a.isFunction(h)){return h}return null},end:0});jEngine.Core.AppEntity=new c()})(jQuery);
