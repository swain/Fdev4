("Grid" in FE.ui)||(function(a,b,c){GridColModel=function(d){this.defaults=d.defaults;this.columns=d.columns;for(key in this.columns){if(!this.columns[key].width){this.columns[key].width=this.defaults.width}if(typeof this.columns[key].sortable=="undefined"||this.columns[key].sortable==null){this.columns[key].sortable=this.defaults.sortable}}};GridColModel.prototype={push:function(d){this.columns.push(d)},get:function(){return this.columns},_getSchemaBykey:function(f){var e=[];var d=0;while(this.columns[d]){e[d]=this.columns[d][f];d++}return e},getIdSchema:function(){return this._getSchemaBykey("id")},getIdColModelMap:function(){var d={};for(key in this.columns){d[this.columns[key].id]=this.columns[key]}return d},getDataIndexSchema:function(){return this._getSchemaBykey("dataIndex")}};Grid=function(e,d){this.id=e;this.attributes=d;this.width=(this.attributes&&this.attributes.width)?this.attributes.width:"100%";this.height=(this.attributes&&this.attributes.height)?this.attributes.height:false;this.limit=(this.attributes&&this.attributes.limit)?this.attributes.limit:10;this.toPageNum=(this.attributes&&this.attributes.toPageNum)?this.attributes.toPageNum:1;this.checkbox=(this.attributes&&this.attributes.checkbox)?this.attributes.checkbox:false;this.hasPages=(this.attributes&&this.attributes.hasPages)?this.attributes.hasPages:false;this.hasPagebar=(this.attributes&&!(typeof this.attributes.hasPagebar=="undefined"||this.attributes.hasPagebar==null)&&!this.attributes.hasPagebar)?this.attributes.hasPagebar:true;this.isRowAuto=(this.attributes&&!(typeof this.attributes.isRowAuto=="undefined"||this.attributes.isRowAuto==null)&&!this.attributes.isRowAuto)?this.attributes.isRowAuto:true;this.defaultSort=(this.attributes&&this.attributes.defaultSort)?this.attributes.defaultSort:"";this.dir=(this.attributes&&this.attributes.dir)?this.attributes.dir:"desc";this.multiSelect=(this.attributes&&this.attributes.multiSelect)?this.attributes.multiSelect:false;this.store=null;this.schema=null;this.colModel=null;this.start=0;this.currentPage=1;this.totalCount=0;this._events={};this.selectDatas={}};Grid.prototype={init:function(f,e,d){var g=this;this.url=f;this.schema=d;if(this.checkbox){e.push({id:"checkbox",renderer:g._renderCheckBox});this.checkAll=a("#"+this.id+" input.xui-simpleGrid-hd-checkbox").eq(0);this.checkAll.bind("click",function(){if(g.checkAll.attr("checked")){g.selectAll()}else{g.cleanRow()}})}this.colModel=e.get();this.idSchema=e.getIdSchema();this.dataIndexSchema=e.getDataIndexSchema();this.colModelMap=e.getIdColModelMap();this.rowDoms=a("#"+this.id+" div.xui-simpleGrid-row");this._addRowDomsEvents();this.getHdDoms();this._addHdDomsEvents();this._renderHead();this.firstBtnDom=a("#"+this.id+" button.xui-pagebar-btn-first").eq(0);this.prevBtnDom=a("#"+this.id+" button.xui-pagebar-btn-prev").eq(0);this.lastBtnDom=a("#"+this.id+" button.xui-pagebar-btn-last").eq(0);this.nextBtnDom=a("#"+this.id+" button.xui-pagebar-btn-next").eq(0);this.numberBtnDom=a("#"+this.id+" input.xui-pagebar-btn-number").eq(0);this.numberStartDom=a("#"+this.id+" span.xui-pagebar-start").eq(0);this.numberEndDom=a("#"+this.id+" span.xui-pagebar-end").eq(0);this.numberTotalDom=a("#"+this.id+" span.xui-pagebar-total").eq(0);this.numberGoDom=a("#"+this.id+" button.xui-pagebar-btn-go").eq(0);this.numberTotalPages=a("#"+this.id+" span.xui-pagebar-pages").eq(0);if(this.hasPagebar){this._initPageBar()}this.toPage(this.toPageNum)},_renderCheckBox:function(d,h,j,f){var e=d?"checked":"";var i=a("#xui-simpleGrid-"+f.id+"-"+j).get(0);if(i){i.checked=e}else{return'<input id="xui-simpleGrid-'+f.id+"-"+j+'" name="" class="xui-simpleGrid-row-checkbox" type="checkbox" value="" '+e+" />"}},getHdDoms:function(){var d=this;if(!this.hdDoms){this.hdDoms={};a.each(this.idSchema,function(e,f){d.hdDoms[f]=a("#"+d.id+" .xui-simpleGrid-header td.xui-simpleGrid-hd-"+d.idSchema[e]).eq(0)})}return this.hdDoms},_renderHead:function(){for(key in this.hdDoms){if(key!="checkbox"&&key!="undefined"){if(typeof this.hdDoms[key]!="undefined"){var d=a("div.xui-simpleGrid-hd-inner",this.hdDoms[key]).get(0);var e=this.colModelMap[key].header;d.innerHTML=e+'<button  class="xui-simpleGrid-sort" ></button>'}}}},_addHdDomsEvents:function(){var d=this;for(key in this.colModelMap){if(this.colModelMap[key].sortable==true){if(this.hdDoms[key]){this.hdDoms[key].addClass("xui-simpleGrid-sort-default");this.hdDoms[key].bind("click",{hdId:key},function(f){var e=f.data.hdId;d.sort(e)})}}}},_addCheckBoxEvent:function(){var d=this;a.each(d.rowDoms,function(e,f){if(a("#xui-simpleGrid-"+d.id+"-"+e).get(0)){var g=a("#xui-simpleGrid-"+d.id+"-"+e).parent();g.bind("click",function(h){h.stopPropagation()});g.parent().bind("click",function(h){h.stopPropagation()})}a("#xui-simpleGrid-"+d.id+"-"+e).bind("click",{rowIndex:e,obj:d},function(h){var j=h.data.rowIndex;var i=h.data.obj;a(i).triggerHandler("checkboxclick",[i.rowDatas[j]]);if(a("#xui-simpleGrid-"+i.id+"-"+j).attr("checked")){i.selectRowByIndex(j)}else{i.unselectRowByIndex(j)}h.stopPropagation()})})},_addRowDomsEvents:function(){var d=this;a.each(d.rowDoms,function(e,f){d.rowDoms.eq(e).bind({click:function(g){var h=g.data.rowIndex;if(d._isInDatasRow(h)){if(!d.multiSelect){d.cleanRow()}if(d.multiSelect){if(a("#xui-simpleGrid-"+d.id+"-"+h).attr("checked")){d.unselectRowByIndex(h)}else{d.selectRowByIndex(h)}}else{d.selectRowByIndex(h)}if(d.rowDatas){a(d).triggerHandler("rowclick",[d.rowDatas[h]])}}}},{rowIndex:e});d.rowDoms.eq(e).bind("dblclick mouseenter mouseleave",{rowIndex:e},function(h){var i=h.data.rowIndex;var g=h.type;if(d._isInDatasRow(i)){switch(g){case"dblclick":if(d.rowDatas){a(d).triggerHandler("rowdblclick",[d.rowDatas[i]])}break;case"mouseenter":d.hoverRowByIndex(i);if(d.rowDatas){a(d).triggerHandler("rowmouseover",[d.rowDatas[i]])}break;case"mouseleave":d.unhoverRowByindex(i);if(d.rowDatas){a(d).triggerHandler("rowmouseout",[d.rowDatas[i]])}break}}})})},_initPageBar:function(){var d=this;this.firstBtnDom.bind("click",function(){d.toFirstPage()});this.prevBtnDom.bind("click",function(){d.toPrevPage()});this.lastBtnDom.bind("click",function(){d.toLastPage()});this.nextBtnDom.bind("click",function(){d.toNextPage()});this.numberGoDom.bind("click",function(){d.toNumberBtnPage()});this.numberBtnDom.bind("keydown",function(e){if(e.keyCode==13){d.toNumberBtnPage()}})},_isInDatasRow:function(d){return(this.rowDatas&&this.rowDatas[d])?true:false},_dirSwitch:function(e,d){if(this.currentHdId){this.hdDoms[this.currentHdId].removeClass("xui-simpleGrid-sort-asc xui-simpleGrid-sort-desc");this.hdDoms[this.currentHdId].addClass("xui-simpleGrid-sort-default")}if(this.currentHdId!=e){if(this.dir&&this.dir=="desc"){this.dir="asc"}}if(d&&d=="desc"){this.dir="asc"}else{if(d&&d=="asc"){this.dir="desc"}}if(this.dir=="desc"){this.dir="asc";this.hdDoms[e].removeClass("xui-simpleGrid-sort-default xui-simpleGrid-sort-asc");this.hdDoms[e].addClass("xui-simpleGrid-sort-asc")}else{if(this.dir=="asc"){this.dir="desc";this.hdDoms[e].removeClass("xui-simpleGrid-sort-default xui-simpleGrid-sort-asc");this.hdDoms[e].addClass("xui-simpleGrid-sort-desc")}}this.currentHdId=e},sort:function(e,d,f){var g=this;this.defaultSort=e;this._dirSwitch(e,d);if(f&&f==true){this.reload()}else{this.load()}a(g).triggerHandler("sort",[e])},reload:function(d){if(d){this.setParams(d)}this.toFirstPage()},load:function(){this.toPage(this.currentPage)},selectAll:function(){var d=this.rowDoms.length;for(var e=0;e<d;e++){this.selectRowByIndex(e)}if(this.checkbox){this.checkAll.attr("checked",true)}},selectRowByIndex:function(e){var d=this;if(this.rowDatas&&!(e>(this.rowDatas.length-1))){this.rowDoms.eq(e).addClass("xui-simpleGrid-row-selected");this.selectRowIndex=e;a(d).triggerHandler("rowselect",[this.rowDatas[e]]);this._registerSelectData(e);if(this.checkbox){if(a("#xui-simpleGrid-"+this.id+"-"+e).get(0)){a("#xui-simpleGrid-"+this.id+"-"+e).attr("checked",true)}}}},getSelectRowIndex:function(){if(this.selectRowIndex){return this.selectRowIndex}},getMouseoverRowIndex:function(){if(this.mousoverRowIndex){return this.mousoverRowIndex}},unselectRowByIndex:function(e){var d=this;if(this.rowDatas&&!(e>(this.rowDatas.length-1))){this.rowDoms.eq(e).removeClass("xui-simpleGrid-row-selected");a(d).triggerHandler("unrowselect",[this.rowDatas[e]]);this._unRegisterSelectData(e);if(this.checkbox){if(a("#xui-simpleGrid-"+this.id+"-"+e).get(0)){a("#xui-simpleGrid-"+this.id+"-"+e).attr("checked",false)}}}},cleanRow:function(){var d=this.rowDoms.length;for(var e=0;e<d;e++){this.unselectRowByIndex(e)}if(this.checkbox){this.checkAll.attr("checked",false)}},hoverRowByIndex:function(d){this.mousoverRowIndex=d;this.rowDoms.eq(d).addClass("xui-simpleGrid-row-hover")},unhoverRowByindex:function(d){this.mousoverRowIndex=null;this.rowDoms.eq(d).removeClass("xui-simpleGrid-row-hover")},setParams:function(d){if(d){for(var e in d){d[e]=encodeURIComponent(d[e])}this.params=d}},_getParamsString:function(){var d="";for(k in this.params){if(k=="defaultSort"){this.defaultSort=this.params[k]}else{if(k=="dir"){this.dir=this.params[k]}else{if(k=="limit"){this.limit=this.params[k]}else{d+="&"+k+"="+this.params[k]+""}}}}return d},toPage:function(d){this.cleanRow();var e=(d-1)*this.limit;if(this.colModelMap[this.defaultSort]){this._dirSwitch(this.defaultSort,this.dir)}this._getData(e);this.currentPage=parseInt(d,10)},_isHiddenPreButton:function(d){if(this.firstBtnDom.get(0)){this.firstBtnDom.attr("disabled",d)}if(this.prevBtnDom.get(0)){this.prevBtnDom.attr("disabled",d)}if(d){this.firstBtnDom.addClass("xui-pagebar-btn-first-disabled");this.prevBtnDom.addClass("xui-pagebar-btn-prev-disabled")}else{this.firstBtnDom.removeClass("xui-pagebar-btn-first-disabled");this.firstBtnDom.addClass("xui-pagebar-btn-first");this.prevBtnDom.removeClass("xui-pagebar-btn-prev-disabled");this.prevBtnDom.addClass("xui-pagebar-btn-prev")}},_isHiddenNextButton:function(d){if(this.lastBtnDom.get(0)){this.lastBtnDom.attr("disabled",d)}if(this.nextBtnDom.get(0)){this.nextBtnDom.attr("disabled",d)}if(d){this.lastBtnDom.addClass("xui-pagebar-btn-last-disabled");this.nextBtnDom.addClass("xui-pagebar-btn-next-disabled")}else{this.lastBtnDom.removeClass("xui-pagebar-btn-last-disabled");this.lastBtnDom.addClass("xui-pagebar-btn-last");this.nextBtnDom.removeClass("xui-pagebar-btn-next-disabled");this.nextBtnDom.addClass("xui-pagebar-btn-next")}},_rendPageBar:function(){var e=(this.currentPage-1)*this.limit;if(this.isFirstPage(this.currentPage)&&this.isLastPage(this.currentPage)){this._isHiddenPreButton(true);this._isHiddenNextButton(true)}else{if(this.isFirstPage(this.currentPage)){this._isHiddenPreButton(true);this._isHiddenNextButton(false)}else{if(this.isLastPage(this.currentPage)){this._isHiddenNextButton(true);this._isHiddenPreButton(false)}else{this._isHiddenPreButton(false);this._isHiddenNextButton(false)}}}if(this.hasPagebar){if(this.numberBtnDom.get(0)){this.numberBtnDom.attr("value",this.currentPage)}if(this.numberStartDom.get(0)){if(this.totalCount==0){this.numberStartDom.html("0")}else{this.numberStartDom.html(e+1)}}if(this.numberEndDom.get(0)){if(this.limit>this.totalCount||(this.isLastPage())){this.numberEndDom.html(this.totalCount)}else{this.numberEndDom.html(e+this.limit)}}if(this.hasPages&&this.numberTotalPages.get(0)){var d=Math.ceil(this.totalCount/this.limit);this.numberTotalPages.html(d)}}},_initSore:function(){},_getData:function(i){var h="start="+i+"&sort="+(this.defaultSort?this.defaultSort:"")+"&dir="+(this.dir?this.dir:"")+"&limit="+(this.limit?this.limit:"");var d="";if(this.params){d=this._getParamsString()}var g=this;try{a.ajax({type:"POST",dataType:"json",url:this.url,data:h+d,success:function(e){g.store=e;if(e.isSuccess===false){a(g).triggerHandler("dserror",[e.message])}else{g._rendData(e)}},error:function(){a(g).triggerHandler("ajaxerror")}})}catch(f){}},_cleanRow:function(d){var f=this.rowDoms.length;for(var e=0;e<f;e++){this.rowDoms.eq(e).css("display",(e>=d)?"none":"block")}},_rendData:function(g){this.rowDatas=g.data;this.totalCount=g.totalCount;if(this.hasPagebar&&this.numberTotalDom.get(0)){this.numberTotalDom.html(this.totalCount)}var d=this.rowDatas.length;this.dataRowDoms=this.rowDoms;d=(d>this.limit)?this.limit:d;if(this.isRowAuto){this._cleanRow(d)}for(var f=0;f<d;f++){this.setRowData(f,this.rowDatas[f])}if(this.limit>d){this.dataRowDoms=this.rowDoms.slice(0,d);for(var e=d;e<this.limit;e++){this.cleanRowData(e)}}if(this.checkbox){this._addCheckBoxEvent()}if(this.hasPagebar){this._rendPageBar()}var g=this;a(g).triggerHandler("dsload",[g]);if(d==0){this.toPrevPage();return}},setRowData:function(j,g){for(var h in g){this.rowDatas[j][h]=g[h]}var d=this.idSchema.length;for(var f=0;f<d;f++){var e="";if(this.colModelMap[this.idSchema[f]].dataIndex){e=this.rowDatas[j][this.colModelMap[this.idSchema[f]].dataIndex]}if(this.checkbox&&this.idSchema[f]=="checkbox"){if(a("#xui-simpleGrid-"+this.id+"-"+j).get(0)){e=a("#xui-simpleGrid-"+this.id+"-"+j).attr("checked")}}this.setCellData(j,this.idSchema[f],e)}},cleanRowData:function(e){if(this.idSchema.length){for(var d=0;d<this.idSchema.length;d++){this.cleanCellData(e,this.idSchema[d])}}else{for(key in this.idSchema){this.cleanCellData(e,this.idSchema[key])}}},setCellData:function(l,g,d){if(this.getCellTextDomByIndex(l,g).get(0)){if(this.colModelMap[g].renderer){try{var f=this.colModelMap[g].renderer(d,this.rowDatas[l],l,this);if(f){this.getCellTextDomByIndex(l,g).html(f)}}catch(j){}}else{var i=jQuery.util.escapeHTML(d);this.getCellTextDomByIndex(l,g).html((typeof i=="undefined"||i==null)?"":i);this.getCellTextDomByIndex(l,g).attr("title",d)}if(this.colModelMap[g].align){this.getCellTextDomByIndex(l,g).css("textAlign",this.colModelMap[g].align)}}},cleanCellData:function(e,d){if(this.getCellTextDomByIndex(e,d)){this.getCellTextDomByIndex(e,d).empty()}},getStore:function(){return this.store},getRowDomByIndex:function(d){return this.rowDoms.eq(d)},getCellDomByIndex:function(g,f){var e=this.getRowDomByIndex(g);var d=a("td.xui-simpleGrid-col-"+f,e).eq(0);return d},getCellTextDomByIndex:function(g,e){var d=this.getCellDomByIndex(g,e);var f=d.children().eq(0);return f},getSelect:function(){var e=[];var d=0;for(key in this.selectDatas){e[d]=this.selectDatas[key];d++}return e},_registerSelectData:function(d){this.selectDatas["rowIndex"+d]=this.rowDatas[d]},_unRegisterSelectData:function(d){delete this.selectDatas["rowIndex"+d]},_tranData:function(){},toNextPage:function(e){var d=this.currentPage+1;this.toPage(d)},toPrevPage:function(){var d=this.currentPage-1;if(d<1){return}this.toPage(d)},toFirstPage:function(){this.toPage(1)},toLastPage:function(){var d=Math.ceil(this.totalCount/this.limit);this.toPage(d)},toNumberBtnPage:function(){var d=jQuery.trim(this.numberBtnDom.attr("value"));var e=Math.ceil(this.totalCount/this.limit);if(d>0&&d<=e){this.toPage(d)}},isFirstPage:function(){return(this.currentPage==1)?true:false},isLastPage:function(){var d=Math.ceil(this.totalCount/this.limit);d=(d==0)?1:d;return(this.currentPage==d)?true:false},getCurrentPage:function(){return this.currentPage},getTotalCount:function(){return this.totalCount},getPageCount:function(){return(this.rowDatas)?(this.rowDatas.length):0}};b.Grid=Grid;b.Grid.GridColModel=GridColModel;a.add("web-grid")})(jQuery,FE.ui);