("alitalk" in FE.util)||(function($,Util){var ie=$.util.ua.ie,$extendIf=$.extendIf,defaults={cls:{base:"alitalk",on:"alitalk-on",off:"alitalk-off",mb:"alitalk-mb"},attr:"alitalk",siteID:"cnalichn",remote:true,prop:"",getAlitalk:function(id){window.open("http://webww.china.alibaba.com/message/my_chat.htm?towimmid="+id,"_blank")},onRemote:function(data){var element=$(this);switch(data.online){case 0:case 2:case 6:default:element.html("给我留言").attr("title","我不在网上，给我留个消息吧");break;case 1:element.html("和我联系").attr("title","我正在网上，马上和我洽谈");break;case 4:case 5:element.html("给我短信").attr("title","我手机在线，马上和我洽谈");break}}},version=0,isInstalled=(function(){if(ie){var vers={"aliimx.wangwangx":6,"Ali_Check.InfoCheck":5};for(var p in vers){try{new ActiveXObject(p);version=vers[p];return true}catch(e){}}}else{if($.browser.mozilla||$.browser.safari){$(function(){if(navigator.mimeTypes["application/ww-plugin"]){var plugin=$("<embed>",{type:"application/ww-plugin",css:{visibility:"hidden",width:0,height:0}});plugin.appendTo(document.body);if((plugin[0].NPWWVersion&&numberify(plugin[0].NPWWVersion())>=1.003)||(plugin[0].isInstalled&&plugin[0].isInstalled(1))){version=6;isInstalled=true;if(Util.alitalk){Util.alitalk.isInstalled=true}}plugin.remove()}})}}return false})();function success(obj,elements,options){if(obj.success){var arr=obj.data;elements.each(function(i){var element=$(this),data=element.data("alitalk");if(data){data.online=arr[i];element.addClass(data.cls.base);switch(data.online){case 0:case 2:case 6:default:element.addClass(data.cls.off);break;case 1:element.addClass(data.cls.on);break;case 4:case 5:element.addClass(data.cls.mb);break}if(data.onRemote){data.onRemote.call(element[0],data)}}})}if(options.onSuccess){options.onSuccess()}}function invokeWW(cmd){var ifr=$("<iframe>").css("display","none").attr("src",cmd).appendTo("body");setTimeout(function(){ifr.remove()},200)}function onClickHandler(event){var element=$(this),data,feedback,prop,info_id;if(event){event.preventDefault();data=element.data("alitalk")}else{data=this}if(!data.remote){data.online=1}if(data.online===null){return}prop=data.prop;if(typeof prop==="function"){prop=prop.call(this);var match=prop.match(/info_id=([^#]+)/);if(match&&match.length===2){info_id=match[1]}}feedback="&url2=http://dmtracking.alibaba.com/others/feedbackfromalitalk.html?online="+data.online+"#info_id="+(data.info_id||info_id||"")+"#type="+(data.type||"")+"#module_ver=3#refer="+encodeURI(document.URL).replace(/&/g,"$");switch(version){case 0:default:data.getAlitalk.call(this,data.id);break;case 5:invokeWW("Alitalk:Send"+(data.online===4?"Sms":"IM")+"?"+data.id+"&siteid="+data.siteID+"&status="+data.online+feedback+prop);break;case 6:if(data.online===4){invokeWW("aliim:smssendmsg?touid="+data.siteID+data.id+feedback+prop)}else{invokeWW("aliim:sendmsg?touid="+data.siteID+data.id+"&siteid="+data.siteID+"&status="+data.online+feedback+prop)}break}if(data.onClickEnd){data.onClickEnd.call(this,event)}}function login(id){var src;if(version===5){src="alitalk:"}else{src="aliim:login?uid="+(id||"")}invokeWW(src)}function numberify(s){var c=0;return parseFloat(s.replace(/\./g,function(){return(c++===0)?".":""}))}function alitalk(elements,options){if($.isPlainObject(elements)){options=elements;options.online=options.online||1;$extendIf(options,defaults);onClickHandler.call(options)}else{options=options||{};$extendIf(options,defaults);elements=$(elements).filter(function(){return !$.data(this,options.attr)});if(elements.length){var ids=[];elements.each(function(i,elem){elem=$(elem);var data=$extendIf(eval("("+(elem.attr(options.attr)||elem.data(options.attr)||"{}")+")"),options);elem.data("alitalk",data);ids.push(data.siteID+data.id)}).bind("click",onClickHandler);if(ids.length&&options.remote){$.ajax("http://amos.im.alisoft.com/mullidstatus.aw",{dataType:"jsonp",data:{uids:ids.join(";")},success:function(o){success(o,elements,options)}})}}}}Util.alitalk=alitalk;Util.alitalk.version=version;Util.alitalk.isInstalled=isInstalled;Util.alitalk.login=login;$.add("web-alitalk")})(jQuery,FE.util);